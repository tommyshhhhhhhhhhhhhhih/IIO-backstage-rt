<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="img/favicon.ico" rel="icon" type="image/x-icon">
    <title>銀行帳戶驗證</title>
    <!--  Bootstrap Core CSS-->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- datepicker-->
    <link href="css/flatpickr.css" rel="stylesheet">
    <!-- DataTables-->
    <link href="css/datatables.min.css" rel="stylesheet">
    <!-- vue select-->
    <link href="css/vue-select.css" rel="stylesheet">
    <!--  Custom CSS -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/table.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
  </head>
  <body>
    <header class="navbar navbar-inverse fixed-top active" id="header">
      <div class="navbar-brand"><a id="menu-toggle"><span class="material-icons">menu</span></a>
        <h1> <a href="./1.0_index.html"><span>IIO</span>營運後台</a></h1>
      </div>
      <ul class="topbar-menu">
        <li><span class="greeting">Have a Good Time</span></li>
        <li>
          <div class="btn-group">
            <button class="dropdown-toggle topbar-btn" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="material-icons">notifications</span><span class="red-dot"></span></button>
            <div class="dropdown-menu dropdown-menu-right">
              <ul class="dropdown-list">
                <li class="dropdown-item"><a class="dropdown-info" href="3.1.1_selling-item.html"><span class="b-caption">[商品審核] [熱門]超可愛小丸子帽子</span></a>
                  <div class="date"><span>今天</span><span>16:55</span></div>
                </li>
                <li class="dropdown-item"><a class="dropdown-info" href="2.1.1_asset-detail.html"><span class="b-caption">[資產審核] 小丸子帽子</span></a>
                  <div class="date"><span>今天</span><span>09:55</span></div>
                </li>
                <li class="dropdown-item read">
                  <div class="dropdown-info">
                    <p class="b-caption">[資產審核] 小丸子鞋子</p>
                  </div>
                  <div class="date"><span>8-12</span></div>
                </li>
                <li class="dropdown-item read">
                  <div class="dropdown-info">
                    <p class="b-caption">[資產審核] 小丸子裙子</p>
                  </div>
                  <div class="date"><span>8-12</span></div>
                </li>
              </ul>
            </div>
          </div>
        </li>
        <li>
          <div class="btn-group">
            <button class="dropdown-toggle topbar-btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="material-icons">person_outline</span></button>
            <div class="dropdown-menu dropdown-menu-right">
              <ul class="dropdown-list">
                <li class="dropdown-item read"><a class="dropdown-info" href="./login.html"><span class="b-caption">登出</span></a></li>
              </ul>
            </div>
          </div>
        </li>
      </ul>
    </header>
    <!-- container-->
    <div class="container-fluid" id="main-content">
      <div class="row">
        <div class="expand" id="sidebar-wrapper">
          <ul id="sidebar"></ul>
          <div class="overlay show"></div>
        </div>
        <div class="col wrap animated fadeIn" id="app">
          <div class="row">
            <div id="gotop"><span class="material-icons">arrow_upward</span></div>
            <div class="col content-top">
              <div class="breadcrum"> 營運後台>財務管理>銀行帳戶驗證
              </div>
              <div class="title-wrap">
                <div class="info">
                  <h2 class="text-h2">銀行帳戶驗證
                  </h2>
                </div>
                <div class="toolbar"> 
                </div>
                <div class="b-caption w-100">使用者提供的銀行帳戶資料進行驗證流程
                </div>
              </div>
              <div class="b-search-group">
                <div class="b-text-field">
                  <label>帳戶提供者</label>
                  <div class="b-field-group">
                    <div class="b-field-row">
                      <div class="b-input-wrap">
                        <v-select class="b-select" :options="['全部','廠商', '一般使用者']" v-model="searchType" placeholder="選擇供應商" :clearable="false"></v-select>
                      </div>
                    </div>
                  </div>
                </div>
                    <div class="b-text-field">
                      <label>名稱
                      </label>
                      <div class="b-field-group"> 
                        <div class="b-field-row">
                          <input class="b-input" type="text" placeholder="search" required>
                        </div>
                      </div>
                    </div>
                <div class="b-text-field">
                  <label>送審日期</label>
                  <div class="b-field-row">
                    <div class="b-input-wrap mr-none">
                      <input class="b-input mr-none" id="dateStart" type="text" v-model="searchDateStart" placeholder="搜尋開始時間">
                    </div><span class="px-xs pt-xxs">~</span>
                    <div class="b-input-wrap">
                      <input class="b-input mr-none" id="dateEnd" type="text" v-model="searchDateEnd" placeholder="搜尋結束時間">
                    </div>
                  </div>
                </div>
                    <div class="b-text-field">
                      <label class="mb-xxs">狀態
                      </label>
                      <div class="b-field-group"> 
                        <div class="b-field-row">
                          <div class="b-radio">
                            <input type="radio" id="全部" name="狀態" value="全部" checked>
                            <label for="全部">全部</label>
                          </div>
                          <div class="b-radio">
                            <input type="radio" id="待驗證" name="狀態" value="待驗證">
                            <label for="待驗證">待驗證</label>
                          </div>
                          <div class="b-radio">
                            <input type="radio" id="驗證中" name="狀態" value="驗證中">
                            <label for="驗證中">驗證中</label>
                          </div>
                          <div class="b-radio">
                            <input type="radio" id="驗證失敗" name="狀態" value="驗證失敗">
                            <label for="驗證失敗">驗證失敗</label>
                          </div>
                          <div class="b-radio">
                            <input type="radio" id="驗證成功" name="狀態" value="驗證成功">
                            <label for="驗證成功">驗證成功</label>
                          </div>
                        </div>
                      </div>
                    </div>
                <div class="b-search-buttons">
                      <button class="b-btn-default ladda-button" data-size="md" data-style="slide-left" type="button"><span class="ladda-label"><i class="fa fa-search"></i>查詢</span><span class="ladda-spinner"></span>
                        <div class="ladda-progress" style="width:0"></div>
                      </button>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="content">
              <div class="b-table-wrap">
                <div class="b-table-title"></div>
                <div class="p-sm">
                  <button class="b-btn-primary outline mb-none mr-none" data-size="md" data-toggle="modal" data-target="#batchConvert">批次轉出txt</button>
                  <button class="b-btn-primary outline mb-none" data-size="md" data-toggle="modal" data-target="#batchConfirm">批次驗證</button>
                </div>
                <div class="table-responsive">
                  <table class="table table-hover" id="accountApply">
                    <thead> 
                      <th>狀態</th>
                      <th>帳戶來源</th>
                      <th>送審日期</th>
                      <th>名稱(姓名/公司)</th>
                      <th>身分證號/統一編號</th>
                      <th>銀行名稱</th>
                      <th>銀行戶名</th>
                      <th>銀行帳號</th>
                      <th>詳細資訊</th>
                      <th>操作</th>
                    </thead>
                    <tbody>
                      <template> 
                        <tr v-for="item,idx in dataGrid">
                          <td> <span class="b-caption">{{status[item.status].label}}</span></td>
                          <td><span>{{ item.type }}</span></td>
                          <td><span>{{ item.createDate }}</span></td>
                          <td><span>{{ item.name }}</span></td>
                          <td><span>{{ item.idCode }}</span></td>
                          <td> <span>{{ item.bank.corp }} </span></td>
                          <td> <span>{{ item.bank.name }} </span></td>
                          <td> <span>{{ item.bank.account }} </span></td>
                          <td> <span>{{ item.info }} </span></td>
                          <td> 
                            <button class="b-btn-secondary outline ml-none mb-none" data-size="xs" v-if="!item.status">轉出txt</button>
                            <button class="b-btn-secondary outline ml-none mb-none" data-size="xs" v-if="!item.status" :data-loading="item.nextStatusLoading" @click="toNextStep(idx)">下一步</button>
                            <button class="b-btn-secondary outline ml-none mb-none" data-size="xs" v-if="item.status === 1" @click="resultSent(idx, 3)">通過</button>
                            <button class="b-btn-secondary outline ml-none mb-none" data-size="xs" v-if="item.status === 1" @click="resultSent(idx, 2)">失敗</button>
                          </td>
                        </tr>
                      </template>
                    </tbody>
                  </table>
                </div>
              </div>
              <!-- 批次轉出-->
              <div class="modal fade" id="batchConvert" data-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span class="material-icons">close</span></button>
                    </div>
                    <div class="modal-body p-none">
                      <div class="d-flex justify-content-between align-items-center px-lg pt-md">
                        <h3 class="modal-title">批次轉出 txt</h3>
                      </div>
                      <div class="table-responsive" style="max-height: 20rem">
                        <table class="table table-hover" id="productList">
                          <thead> 
                            <th> 
                              <div class="b-checkbox mr-none mb-none">
                                <input type="checkbox" id="selectAllConvert" v-model="selectAllConvert">
                                <label for="selectAllConvert"> </label>
                              </div>
                            </th>
                            <th>狀態</th>
                            <th>帳戶來源</th>
                            <th>送審日期</th>
                            <th>名稱(姓名/公司)</th>
                            <th>身分證號/統一編號</th>
                            <th>銀行名稱</th>
                            <th>銀行戶名</th>
                            <th>銀行帳號</th>
                            <th>詳細資訊</th>
                          </thead>
                          <tbody>
                            <template> 
                              <tr v-for="item,idx in dataGrid" v-if="!item.status">
                                <td> 
                                  <div class="b-checkbox mr-none mb-none">  
                                    <input type="checkbox" :id="'checkbox'+idx" @change="changeSelect" v-model="item.selected">
                                    <label :for="'checkbox'+idx"> </label>
                                  </div>
                                </td>
                                <td><span class="b-caption">{{status[item.status].label}}</span></td>
                                <td><span>{{ item.type }}</span></td>
                                <td><span>{{ item.createDate }}</span></td>
                                <td><span>{{ item.name }}</span></td>
                                <td><span>{{ item.idCode }}</span></td>
                                <td> <span>{{ item.bank.corp }} </span></td>
                                <td> <span>{{ item.bank.name }} </span></td>
                                <td> <span>{{ item.bank.account }} </span></td>
                                <td> <span>{{ item.info }} </span></td>
                              </tr>
                            </template>
                          </tbody>
                        </table>
                      </div>
                      <div class="d-flex justify-content-center align-items-center py-md"> <span class="text-A">已選擇 {{ selectItemConvert }} 筆</span>
                        <button class="b-btn-primary" data-size="md" :disabled="btnStatus.convert" :data-loading="btnStatus.convert" @click="convertSent">轉出 txt</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 批次驗證-->
              <div class="modal fade" id="batchConfirm" data-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span class="material-icons">close</span></button>
                    </div>
                    <div class="modal-body p-none">
                      <div class="d-flex justify-content-between align-items-center px-lg pt-md">
                        <h3 class="modal-title">批次驗證</h3>
                        <div class="pb-xs"></div>
                      </div>
                      <div class="table-responsive" style="max-height: 20rem">
                        <table class="table table-hover" id="productList">
                          <thead> 
                            <th> 
                              <div class="b-checkbox mr-none mb-none">
                                <input type="checkbox" id="selectAllConfirm" v-model="selectAllConfirm">
                                <label for="selectAllConfirm"> </label>
                              </div>
                            </th>
                            <th>狀態</th>
                            <th>帳戶來源</th>
                            <th>送審日期</th>
                            <th>名稱(姓名/公司)</th>
                            <th>身分證號/統一編號</th>
                            <th>銀行名稱</th>
                            <th>銀行戶名</th>
                            <th>銀行帳號</th>
                            <th>詳細資訊</th>
                          </thead>
                          <tbody>
                            <template> 
                              <tr v-for="item,idx in dataGrid" v-if="item.status === 1">
                                <td> 
                                  <div class="b-checkbox mr-none mb-none">  
                                    <input type="checkbox" :id="'checkbox'+idx" @change="changeSelectConfirm" v-model="item.selected">
                                    <label :for="'checkbox'+idx"> </label>
                                  </div>
                                </td>
                                <td>
                                  <sspan class="b-caption">{{status[item.status].label}}</sspan>
                                </td>
                                <td><span>{{ item.type }}</span></td>
                                <td><span>{{ item.createDate }}</span></td>
                                <td><span>{{ item.name }}</span></td>
                                <td><span>{{ item.idCode }}</span></td>
                                <td> <span>{{ item.bank.corp }} </span></td>
                                <td> <span>{{ item.bank.name }} </span></td>
                                <td> <span>{{ item.bank.account }} </span></td>
                                <td> <span>{{ item.info }} </span></td>
                              </tr>
                            </template>
                          </tbody>
                        </table>
                      </div>
                      <div class="d-flex justify-content-center align-items-center py-md"> <span class="text-A">已選擇 {{ selectItemConfirm }} 筆</span>
                        <button class="b-btn-success mr-none" data-size="md" :data-loading="btnStatus.success" @click="batchResultSent(3)">批次成功</button>
                        <button class="b-btn-danger" data-size="md" :data-loading="btnStatus.fail" @click="batchResultSent(2)">批次失敗</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 送出-->
              <div class="modal fade" id="success" data-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm" role="document">
                  <div class="modal-img" data-type="success"></div>
                  <div class="modal-content">
                    <div class="modal-body text-center">
                      <h3 class="modal-title">已送出結果</h3>
                    </div>
                    <div class="modal-footer justify-content-center pt-none">
                      <button class="b-btn-default outline" data-size="lg" type="button" data-dismiss="modal">關閉</button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 單筆送出確認-->
              <div class="modal fade" id="confirm" data-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm" role="document">
                  <div class="modal-img" data-type="warning"></div>
                  <div class="modal-content">
                    <div class="modal-body text-center">
                      <h3 class="modal-title" v-if="current.result === 2">確認驗證失敗？</h3>
                      <h3 class="modal-title" v-if="current.result === 3">確認驗證成功？</h3>
                    </div>
                    <div class="modal-footer justify-content-center pt-none">
                      <button class="b-btn-primary" data-size="lg" type="button" @click="closeConfirm('Y')">確定</button>
                      <button class="b-btn-default text no-underline" data-size="lg" type="button" @click="closeConfirm()">關閉</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="footer">
            <div class="copyright">&copy;2021 GASH Co, Ltd. All Right Reserved. </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Vue-->
    <script src="js/vue.min.js"></script>
    <!-- jQuery-->
    <script src="js/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap Core JavaScript-->
    <script src="js/bootstrap.min.js"></script>
    <!-- input plugin-->
    <script src="js/datatables.min.js"></script>
    <!-- input plugin-->
    <script src="js/flatpickr.js"></script>
    <!-- multiselector-->
    <script src="js/vue-select.js"></script>
    <!-- number-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <!-- Custom JavaScript-->
    <script src="js/sidebar.js"></script>
    <script src="js/custom.js"></script>
    <script>
      currentPage('銀行帳戶驗證');
      
      var vm = new Vue({
          el: '#app',
          data: {
              status: [
                  {label: '待驗證', markColor: 'info'},
                  {label: '驗證中', markColor: 'warning'},
                  {label: '驗證失敗', markColor: 'danger'},
                  {label: '驗證成功', markColor: 'success'},
              ],
              searchType: '',
              searchDateStart:'',
              searchDateEnd:'',
              dataGrid: [
                  {
                      status: 0,
                      type: '廠商',
                      selected: false,
                      createDate: '2022/1/8 15:11',
                      name: 'OO數位',
                      idCode: '34565678',
                      nextStatusLoading: false,
                      bank: {
                          corp: 'OO銀行',
                          name: 'OO數位有限公司',
                          account: '0123456-9876543',
                      }
                  },
                  {
                      status: 0,
                      type: '廠商',
                      selected: false,
                      createDate: '2022/1/8 15:11',
                      name: 'OO數位',
                      idCode: '34565678',
                      nextStatusLoading: false,
                      bank: {
                          corp: 'OO銀行',
                          name: 'OO數位有限公司',
                          account: '0123456-9876543',
                      }
                  },
                  {
                      status: 0,
                      type: '一般使用者',
                      selected: false,
                      createDate: '2022/1/8 15:11',
                      name: 'OOO',
                      idCode: '34565678',
                      nextStatusLoading: false,
                      bank: {
                          corp: 'OO銀行',
                          name: 'OOO',
                          account: '0123456-9876543',
                      }
                  },
                  {
                      status: 1,
                      type: '廠商',
                      selected: false,
                      createDate: '2022/1/8 15:11',
                      name: 'OOO',
                      idCode: '34565678',
                      nextStatusLoading: false,
                      bank: {
                          corp: 'OO銀行',
                          name: 'OOO',
                          account: '0123456-9876543',
                      }
                    },
                  {
                      status: 1,
                      type: '一般使用者',
                      selected: false,
                      createDate: '2022/1/8 15:11',
                      name: 'OOO',
                      idCode: '34565678',
                      nextStatusLoading: false,
                      bank: {
                          corp: 'OO銀行',
                          name: 'OOO',
                          account: '0123456-9876543',
                      }
                  },
                  {
                      status: 2,
                      type: '一般使用者',
                      selected: false,
                      createDate: '2022/1/8 15:11',
                      name: 'OOO',
                      idCode: '34565678',
                      nextStatusLoading: false,
                      bank: {
                          corp: 'OO銀行',
                          name: 'OOO',
                          account: '0123456-9876543',
                      }
                  },
                  {
                      status: 3,
                      type: '一般使用者',
                      selected: false,
                      createDate: '2022/1/8 15:11',
                      name: 'OOO',
                      idCode: '34565678',
                      nextStatusLoading: false,
                      bank: {
                          corp: 'OO銀行',
                          name: 'OOO',
                          account: '0123456-9876543',
                      }
                  },
              ],
              selectAllConvert: false,
              selectItemConvert: 0,
              selectAllConfirm: false,
              selectItemConfirm: 0,
              btnStatus: {
                  success: false,
                  fail: false,
                  convert: false,
              },
              current: {
                  idx: 0,
                  result: 0
              },
          },
          watch: {
              selectAllConvert: function(){
                  let isSelectAll = this.selectAllConvert
                  let row = 0
                  this.dataGrid.forEach(function(item, index, array){
                      if(!item.status) {
                          item.selected = isSelectAll;   
                          row ++      
                      }
                  });
                  isSelectAll? this.selectItemConvert = row: this.selectItemConvert=0
              },
              selectAllConfirm: function(){
                  let isSelectAll = this.selectAllConfirm
                  let row = 0
                  this.dataGrid.forEach(function(item, index, array){
                      if(item.status === 1) {
                          item.selected = isSelectAll;   
                          row ++      
                      }
                  });
                  isSelectAll? this.selectItemConfirm = row: this.selectItemConfirm=0
              },
          },
          methods: {
              changeSelect(e) {
                  if(e.target.checked) {
                      this.selectItemConvert ++ 
                  } else {
                      this.selectItemConvert --
                  }
              },
              changeSelectConfirm(e) {
                  if(e.target.checked) {
                      this.selectItemConfirm ++ 
                  } else {
                      this.selectItemConfirm --
                  }
              },
              sentConfirm(str) {
                  if (str === 'success') {
                      this.btnStatus.success = true
                  }else {
                      this.btnStatus.fail = true
                  }
                  window.setTimeout(function(){
                      vm.btnStatus.fail = false
                      vm.btnStatus.success = false
                      $('#batchConfirm').modal('hide')
                      $('#success').modal('show')
                  }, 2000);
              },
              toNextStep(idx) {
                  this.dataGrid[idx].nextStatusLoading = true
                  window.setTimeout(function(){
                      vm.dataGrid[idx].nextStatusLoading = false
                      vm.dataGrid[idx].status += 1
                  }, 1000);
              },
              convertSent() {
                  this.btnStatus.convert = true
                  window.setTimeout(function(){
                      vm.btnStatus.convert = false
                      vm.dataGrid.forEach(function(item, index, array){
                          if(item.selected) {
                              item.selected = false;         
                          }
                      });
                      $('#batchConvert').modal('hide')
                  }, 600);
              },
              resultSent(idx,result) {
                  $('#confirm').modal('show')
                  this.current.idx = idx 
                  this.current.result = result
              },
              closeConfirm(action) {
                  let id = this.current.idx;
                  let res = this.current.result;
                  if(action) {
                      this.dataGrid[id].status = res
                  }
                  id = '' ;
                  res = '';
                  $('#confirm').modal('hide');
              },
              batchResultSent(result) {
                  if (result === 2 ){
                      this.btnStatus.fail = true
                  } else {
                      this.btnStatus.success = true
                  }
                  
                  window.setTimeout(function(){
                      vm.btnStatus.success = false
                      vm.btnStatus.fail = false
      
                      vm.dataGrid.forEach(function(item, index, array){
                          if(item.selected) {
                              item.status = result      
                          }
                      });
                      vm.dataGrid.forEach(function(item, index, array){
                          if(item.selected) {
                              item.selected = false;         
                          }
                      });
                  }, 1000);
              },
              
          },
          mounted: function () {
          }
      })
      $(document).ready(function() {
          $("#dateStart").flatpickr({
              static: true,
              dateFormat: "Y/m/d",
          });
          $("#dateEnd").flatpickr({
              static: true,
              dateFormat: "Y/m/d",
          });
      
          $('#accountApply').DataTable({
              "pagingType": "full_numbers",
              "language": {
                  "decimal":        "",
                  "emptyTable":     "沒有可顯示的資料",
                  "info":           "顯示從 _START_ 到 _END_ 共 _TOTAL_ 筆資料",
                  "infoEmpty":      "顯示從 0 到 0 共 0 筆資料",
                  "infoFiltered":   "(從 _MAX_ 筆篩選出)",
                  "infoPostFix":    "",
                  "thousands":      ",",
                  "lengthMenu":     "顯示 _MENU_ 筆資料",
                  "loadingRecords": "載入中...",
                  "processing":     "執行中...",
                  "search":         "篩選資料: ",
                  "zeroRecords":    "查無符合資料",
                  "paginate": {
                      "first":      "第一筆",
                      "last":       "最後一筆",
                      "next":       "下一筆",
                      "previous":   "上一筆"
                  },
                  "aria": {
                      "sortAscending":  ": activate to sort column ascending",
                      "sortDescending": ": activate to sort column descending"
                  }
              },
              "order": [[ 0, "asc" ]],
              scrollY:        '25rem',
              searching:      false,
              scrollX:        true,
              searching:      false,
              scrollCollapse: true,
              fixedColumns:   {
                  left: 0,
                  right: 1
              }
          });
      } );
    </script>
  </body>
</html>